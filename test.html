<html>
<head>
<title>my first page</title>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js"></script>
<script type="text/javascript">
(function($) {
	$(document).ready(function() {
		var wall = "#";
		var player = "@";
		var playerOnGoal = "+";
		var box = "$";
		var boxOnGoal = "*";
		var goal = ".";
		var floor = " ";

		var playerx;
		var playery;
		var board;
		var rowcount;
		var colcount;

		function initBoard() {
			playerx = 10;
			playery = 10;
			board = [];

			var rows=20;
			var cols=30;
			for(var row=0;row<rows;++row){
				var columns = [];
				for(var col=0;col<cols;++col){
					var cellvalue = floor;
					if(row == 0 || row == rows-1 || col == 0 || col == cols-1) cellvalue = wall;
					columns[col] = cellvalue;
				}
				board[row] = columns;
			}
			
			board[playery][playerx] = player;
			board[playery-1][playerx] = box;
			board[playery-2][playerx] = goal;

			rowcount = board.length;
			colcount = board[0].length;
		}

		function drawBoard() {
			var html="<table>";
			for(var row=0;row<rowcount;++row) {
				html += "<tr>";
				for(var col=0;col<colcount;++col) {
					html += "<td id='row" + row +"col" +col +"' class='gamecell'>" + board[row][col] + "</td>";
				}
				html += "</tr>";
			}
			html += "</table>";

			$("#game").html(html);
		};

		function getCellHtml(row, col) {
			return board[row][col];
		}

		function drawUpdate(playery, playerx, newplayery, newplayerx, newboxy, newboxx) {
			if(newboxy != null && newboxx != null) $("#row" + newboxy + "col" + newboxx).html(getCellHtml(newboxy,newboxx));
			$("#row" + newplayery + "col" + newplayerx).html(getCellHtml(newplayery,newplayerx));
			$("#row" + playery + "col" + playerx).html(getCellHtml(playery,playerx));
		}

		function isCompleted() {
			for(var row=0;row<rowcount;++row) {
				for(var col=0;col<colcount;++col) {
					if (board[row][col] == box) {
						return false;
					}	
				}
			}	
			return true;
		}

		initBoard();
		drawBoard();

		$(document).keydown(function(e) {
				var dx = 0;
				var dy = 0;
				if(e.keyCode==37) dx = -1;
				if(e.keyCode==38) dy = -1;
				if(e.keyCode==39) dx = 1;
				if(e.keyCode==40) dy = 1;
				var playervalue = board[playery][playerx];
				var newplayerx = playerx + dx;
				var newplayery = playery + dy;
				var newplayervalue = board[newplayery][newplayerx];
				var newboxx = null;
				var newboxy = null;
				if(newplayervalue == wall) return;
				if(newplayervalue == box || newplayervalue == boxOnGoal) {
					newboxx = newplayerx + dx;
					newboxy = newplayery + dy;
					var newboxvalue = board[newboxy][newboxx];
					if(newboxvalue != floor && newboxvalue != goal) return;
					board[newboxy][newboxx] = newboxvalue == goal ? boxOnGoal : box;
				}
				board[playery][playerx] = playervalue == playerOnGoal ? goal : floor;				
				board[newplayery][newplayerx] = newplayervalue == boxOnGoal || newplayervalue == goal ? playerOnGoal : player;
				drawUpdate(playery, playerx, newplayery, newplayerx, newboxy, newboxx);
				playerx=newplayerx;
				playery=newplayery;
				if (isCompleted()) {
					alert("Congratulations. You completed this level");
					initBoard();
					drawBoard();
				}
		});
	});
})(jQuery);
</script>
<style>
.gamecell { width: 20px; height: 20px; background-color: lightgrey; }
</style>
</head>
<body>
	<form>
		<div id="game"></div>
	</form>
</body>
</html>
